<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>CSS Conditions – An Alternative To Container Queries</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="description" content="The concept of CSS container queries (aka element queries) has been around for quite some time, you can read more about them in this great article from Ethan Marcotte. They can be used today with JavaScript libraries like EQCSS or my own cq-prolyfill. But from the browsers side there is not much progress on this topic. Mainly because the proposed functionality cannot be implemented without mixing style computation and layout or introducing some sort of “viewport elements”, which both seem to be impractical or bad for performance. I think there is an easier way to achieve what web developers want, without having to mess around with browser internals or circularity issues.">
<style>html{-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,footer,header{display:block}a{background-color:transparent}a:active,a:hover{outline:0}img{border:0}pre{overflow:auto}code,pre{font-family:monospace,monospace;font-size:1em}html{box-sizing:border-box;-moz-tab-size:4;-o-tab-size:4;tab-size:4;font:87.5%/1.5 system-ui,-apple-system,BlinkMacSystemFont,sans-serif;color:#000}@media (min-width:600px){html{font-size:100%}}@media (min-width:800px){html{font-size:112.5%}}@media (min-width:1000px){html{font-size:125%}}*,:after,:before{box-sizing:inherit}h1,h2,h3{margin:1.5em 0 .5em;font-weight:inherit}h1,h2{line-height:1.2}h1{font-size:1.75em}h2{font-size:1.5em}h3{font-size:1.25em}p{margin:1em 0}a{color:#2d7ab3;text-decoration:none}a:visited{color:#882db3}a:focus,a:hover{color:#2d7ab3;text-decoration:underline}code,pre{border-radius:.2em}code{padding:.1em .3em;font-size:.9em;background:#eee;box-shadow:0 0 0 .5px #ccc}pre{padding:.5em .75em;-webkit-overflow-scrolling:touch;color:#fff;background:#000}pre>code{padding:0;background:transparent;box-shadow:none}.page{max-width:35em;margin:0 auto;padding:1em 2em}.post{padding-bottom:3em;border-bottom:2px solid #ccc}.post-header{display:-webkit-box;display:-ms-flexbox;display:flex;-webkit-box-align:baseline;-ms-flex-align:baseline;align-items:baseline;-webkit-box-pack:justify;-ms-flex-pack:justify;justify-content:space-between;-ms-flex-wrap:wrap;flex-wrap:wrap;margin-right:-.5em;margin-left:-.5em}.post-headline{padding-right:.28571em;padding-left:.28571em}.post-date{padding-right:.5em;padding-left:.5em}.post-date>a{color:inherit}.post-date>a:focus,.post-date>a:hover{color:#2d7ab3;text-decoration:none}.profile{margin:4em 0 2em;text-align:center;font-size:.8em}.profile-image{display:block;margin:0 auto;width:70px;border:3px solid transparent;border-radius:99em;overflow:hidden;background:-webkit-radial-gradient(31px,#000 97%,transparent 100%) no-repeat;background:radial-gradient(31px,#000 97%,transparent 100%) no-repeat}.profile-image:focus,.profile-image:hover{border-color:#2d7ab3}.profile-image>img{display:block;width:64px;height:64px}.profile>h3{margin:1em 0 0}.profile>p{margin:.5em 0 0}.profile a{color:inherit}.profile a:focus,.profile a:hover{color:#2d7ab3;text-decoration:none}.token.punctuation{color:#f8f8f2}.token.property{color:#f92672}.token.selector{color:#a6e22e}.token.atrule,.token.function{color:#e6db74}</style>
<link rel="canonical" href="https://au.si/css-conditions-cq-alternative">
<link rel="icon" href="/images/profile-64.jpg" type="image/jpeg">
</head>
<body>
<div class="page h-entry">
<article class="post">
<header class="post-header">
<h1 class="post-headline p-name">CSS Conditions – An Alternative To Container Queries</h1>
<time class="post-date dt-published" datetime="2017-03-04"><a class="u-url" href="/css-conditions-cq-alternative">4 Mar 2017</a></time>
</header>
<div class="e-content">
<p>The concept of CSS <a href="https://github.com/ResponsiveImagesCG/container-queries">container queries</a> (aka element queries) has been around for quite some time, you can read more about them in <a href="https://ethanmarcotte.com/wrote/on-container-queries/">this great article</a> from Ethan Marcotte. They can be used today with JavaScript libraries like <a href="http://elementqueries.com/">EQCSS</a> or my own <a href="https://github.com/ausi/cq-prolyfill">cq-prolyfill</a>. But from the browsers side there is not much progress on this topic. Mainly because the proposed functionality cannot be implemented without mixing style computation and layout or introducing some sort of “viewport elements”, which both seem to be impractical or bad for performance.</p>
<p>I think there is an easier way to achieve what web developers want, without having to mess around with browser internals or circularity issues.</p>
<h2 id="css-conditions">CSS Conditions</h2>
<p>My proposal for CSS conditions is very straight forward: You have a condition and a block of declarations that get applied if the condition evaluates to true.</p>
<pre><code class="lang-css"><span class="token atrule"><span class="token rule">@when</span> <span class="token punctuation">(</span>&lt;condition><span class="token punctuation">)</span></span> <span class="token punctuation">{</span> &lt;list-of-declarations> <span class="token punctuation">}</span>
</code></pre>
<p>This could look like so:</p>
<pre><code class="lang-css"><span class="token selector">.my-element</span> <span class="token punctuation">{</span>
	<span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
	<span class="token atrule"><span class="token rule">@when</span> <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--my-prop<span class="token punctuation">)</span> > 200px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
		<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
		<span class="token property">width</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>This is a very powerful feature and can be useful for all kinds of situations I think. It should not be too hard for browsers to get this working because with <a href="http://tabatkins.github.io/specs/css-apply-rule/"><code>@apply</code></a> browsers can already add declarations based on CSS variables. An <a href="http://kizu.ru/en/fun/conditions-for-css-variables/">awesome workaround</a> exists today that makes CSS conditions possible, but it’s very limited and can only be used for properties that support <code>calc()</code>.</p>
<h2 id="how-does-it-get-us-closer-to-container-queries-">How does it get us closer to container queries?</h2>
<p>Container queries are not much different to my concept of CSS conditions, the only – but big – difference is that the condition is based on the actual width of an element, not a CSS variable. So how do we get the elements width into a CSS variable? I think there are two options:</p>
<p>We could use a simple script that uses <a href="https://developers.google.com/web/updates/2016/10/resizeobserver">ResizeObserver</a> to watch our effected elements and sets a <code>--element-width</code> variable on them. After that, it’s easy to create conditional styles based on this variable. It would be way simpler to write than current container query scripts and is also extendable to all kinds of element properties that we want to write conditional styles for, see <a href="http://elementqueries.com/">EQCSS</a> to get an idea of query properties that might be useful.</p>
<p>The other option is to take a declarative approach by setting an <code>--available-width</code> variable in CSS and passing it down to its children. This makes it completely independent from JavaScript and the layout process. At the <code>:root</code> level we could start with <code>100vw</code>, a 50% wide element could set it to <code>(--available-width / 2)</code> and for fixed width elements we could just set it directly to <code>800px</code>. To get this working we would also need to fix <a href="https://au.si/self-referencing-css-variables">self-referencing CSS variables</a>. In CSS it would look like this:</p>
<pre><code class="lang-css"><span class="token selector">:root</span> <span class="token punctuation">{</span> <span class="token property">--available-width</span><span class="token punctuation">:</span> 100vw <span class="token punctuation">}</span>
<span class="token selector">.wrapper</span> <span class="token punctuation">{</span>
	<span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
	<span class="token property">--available-width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.column</span> <span class="token punctuation">{</span>
	<span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
	<span class="token property">--available-width</span><span class="token punctuation">:</span> <span class="token function">calc</span><span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--available-width<span class="token punctuation">)</span> / 2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.component</span> <span class="token punctuation">{</span>
	<span class="token atrule"><span class="token rule">@when</span> <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--available-width<span class="token punctuation">)</span> > 200px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
		<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>No matter where the <code>.component</code> would be placed on the page, its styles would react to the <code>available-width</code> variable of the parent element.</p>
<p>For smaller projects, using keywords instead of widths might be enough. For example <code>--context: wide</code> for the content area and <code>--context: narrow</code> for the sidebar. For smaller viewports it will then be set to <code>narrow</code> for the content area via a media query.</p>
<pre><code class="lang-css"><span class="token selector">.sidebar</span> <span class="token punctuation">{</span> <span class="token property">--context</span><span class="token punctuation">:</span> narrow <span class="token punctuation">}</span>
<span class="token selector">.content</span> <span class="token punctuation">{</span> <span class="token property">--context</span><span class="token punctuation">:</span> wide <span class="token punctuation">}</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">max-width</span><span class="token punctuation">:</span> 900px<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
	<span class="token selector">.content</span> <span class="token punctuation">{</span> <span class="token property">--context</span><span class="token punctuation">:</span> narrow <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token selector">.component</span> <span class="token punctuation">{</span>
	<span class="token atrule"><span class="token rule">@when</span> <span class="token punctuation">(</span><span class="token function">var</span><span class="token punctuation">(</span>--context<span class="token punctuation">)</span> = wide<span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
		<span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>Even though this is not as convenient as the original proposals for container queries, it should be much easier to implement, doesn’t suffer from the circularity problem and is still powerful enough to solve the <a href="https://responsiveimagescg.github.io/cq-usecases/">RICG use-cases</a>.</p>
<h2 id="and-now-">And now?</h2>
<p>If you think this idea could work, or have any suggestions, feel free to comment on the <a href="https://github.com/ResponsiveImagesCG/container-queries/issues/5">GitHub issue container-queries#5</a>, talk about the <a href="https://discourse.wicg.io/t/css-conditions-with-variables/2048">CSS conditions feature on WICG Discourse</a> or ping me <a href="https://twitter.com/ausi">on Twitter</a>.</p>
</div>
</article>
<footer class="profile h-card">
<a href="/" class="profile-image">
<img class="u-photo" alt="Martin Auswöger"
srcset="/images/profile-128.jpg 2x"
src="/images/profile-64.jpg"
>
</a>
<h3><a class="u-email p-name" href="mailto:martin@auswoeger.com" rel="me">Martin Auswöger</a></h3>
<p>
@<a class="p-nickname" href="/">ausi</a> on
<a class="u-url" href="https://twitter.com/ausi" rel="me">Twitter</a>,
<a class="u-url" href="https://github.com/ausi" rel="me">GitHub</a>,
<a class="u-url" href="https://www.patreon.com/ausi" rel="me">Patreon</a> and
<a class="u-url" href="https://stackoverflow.com/users/1031606/ausi" rel="me">Stack Overflow</a>
</p>
</footer>
</div>
</body>
</html>
